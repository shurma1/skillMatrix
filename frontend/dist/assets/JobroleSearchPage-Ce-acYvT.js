import{j as e,I as y,z as R,Q as k,B as F,F as g,W as J,d as I,r as c,at as T,b_ as z,c as O,T as P,O as C}from"./index-C2zTCuKe.js";import{u as M}from"./useDebounce-C9xaHpZH.js";import{F as Q}from"./Table-Ck7p-nsh.js";import"./index-G1xJ3cLY.js";import"./Pagination-Bu1Ky6rp.js";import"./FileOutlined-2qhVAVZV.js";const B=({value:a,onChange:o,loading:r,placeholder:t})=>e.jsx(y,{allowClear:!0,value:a,placeholder:t||"Поиск ролей по названию",onChange:s=>o(s.target.value),prefix:e.jsx(k,{style:{color:"#999"}}),suffix:r?e.jsx(R,{size:"small"}):void 0}),q=({query:a,loading:o,onQueryChange:r,onCreateClick:t})=>e.jsxs("div",{style:{display:"flex",gap:16,alignItems:"center",width:"100%",marginBottom:16},children:[e.jsx("div",{style:{flex:1},children:e.jsx(B,{value:a,onChange:r,loading:o})}),e.jsx(F,{type:"primary",onClick:t,style:{whiteSpace:"nowrap"},children:"Создать роль"})]}),E=({data:a,loading:o,total:r,page:t,pageSize:s,onPageChange:l,onRowClick:i})=>{const d=[{title:"Название роли",dataIndex:"title"}];return e.jsx(Q,{size:"middle",rowKey:u=>u.id,loading:o,dataSource:a,pagination:{current:t,pageSize:s,total:r,onChange:l,showSizeChanger:!0},onRow:u=>({onClick:()=>i(u),style:{cursor:"pointer"}}),columns:d})},L=({open:a,confirmLoading:o,onCancel:r,onSubmit:t})=>{const[s]=g.useForm(),l=async()=>{try{const d=await s.validateFields();t(d),s.resetFields()}catch{}},i=()=>{s.resetFields(),r()};return e.jsx(J,{open:a,title:"Создать роль",onCancel:i,onOk:l,confirmLoading:o,okText:"Создать",cancelText:"Отмена",destroyOnClose:!0,children:e.jsx(g,{form:s,layout:"vertical",preserve:!1,children:e.jsx(g.Item,{name:"title",label:"Название роли",rules:[{required:!0,message:"Введите название роли"}],children:e.jsx(y,{placeholder:"Введите название роли"})})})})},$=()=>{const a=I(),[o,r]=c.useState(""),t=M(o,600),[s,l]=c.useState(1),[i,d]=c.useState(10),[u,p]=c.useState(!1),{data:m,isFetching:x}=T({query:t||" ",limit:i,page:s},{skip:!t&&t!==""}),[j,{isLoading:b}]=z();c.useEffect(()=>{l(1)},[t]);const f=(h,n)=>{l(h),d(n)},S=async h=>{try{const n=await j(h).unwrap();C.success("Роль создана"),p(!1),a(`/jobroles/${n.id}/`)}catch(n){const v=n&&typeof n=="object"&&"data"in n?n.data?.message:"Ошибка создания роли";C.error(v||"Ошибка создания роли")}},w=c.useCallback(h=>{a(`/jobroles/${h.id}/`)},[a]);return e.jsxs(O,{vertical:!0,children:[e.jsx(P.Title,{level:3,style:{marginTop:0,marginBottom:16},children:"Роли"}),e.jsx(q,{query:o,loading:x,onQueryChange:r,onCreateClick:()=>p(!0)}),e.jsx(E,{data:m?.rows||[],loading:x,total:m?.count||0,page:s,pageSize:i,onPageChange:f,onRowClick:w}),e.jsx(L,{open:u,confirmLoading:b,onCancel:()=>p(!1),onSubmit:S})]})},G=()=>e.jsx($,{});export{G as default};
