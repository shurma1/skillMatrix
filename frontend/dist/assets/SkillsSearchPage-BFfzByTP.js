import{j as e,I as w,Q as ne,ap as I,S as b,V as le,aF as ie,B as Q,aG as B,g as oe,r as h,c as re,y as de,F as p,W,aH as ce,aI as ue,aJ as H,aK as he,O as f,d as pe,X as ge,as as me,aL as xe,aM as je,aN as ye,T as Ce}from"./index-C2zTCuKe.js";import{u as Se}from"./useDebounce-C9xaHpZH.js";import{D as V}from"./index-JSlmoLFU.js";import{F as fe}from"./Table-Ck7p-nsh.js";import"./index-G1xJ3cLY.js";import"./Pagination-Bu1Ky6rp.js";import"./FileOutlined-2qhVAVZV.js";const ve=({value:o,onChange:d,placeholder:l})=>e.jsx(w,{allowClear:!0,placeholder:l||"–ü–æ–∏—Å–∫ –Ω–∞–≤—ã–∫–æ–≤",value:o,onChange:r=>d(r.target.value),prefix:e.jsx(ne,{}),style:{width:240}}),Ie=({value:o,loading:d,placeholder:l,tags:r,onChange:c,style:i})=>e.jsx(I,{mode:"multiple",allowClear:!0,placeholder:l,value:o,onChange:c,loading:d,style:i,options:r.map(a=>({value:a.id,label:a.name}))}),_=({value:o,loading:d,placeholder:l,users:r,onChange:c,style:i})=>e.jsx(I,{mode:"multiple",allowClear:!0,placeholder:l,value:o,onChange:c,loading:d,style:i,options:r.map(a=>({value:a.id,label:e.jsxs(b,{size:8,children:[e.jsx(le,{size:24,src:a.avatar_id?`${ie}/api/image/${a.avatar_id}?thumb=true`:void 0,children:!a.avatar_id&&(a.firstname?.[0]||a.login?.[0]||"U")}),e.jsx("span",{children:`${a.lastname} ${a.firstname} ${a.patronymic||""}`.trim()})]})}))}),ke=({query:o,tagIds:d,authorIds:l,verifierIds:r,tags:c,users:i,isTagsLoading:a,isUsersLoading:g,onQueryChange:s,onTagIdsChange:n,onAuthorIdsChange:m,onVerifierIdsChange:v,onApprovedRangeChange:x,onAuditRangeChange:k,onCreateClick:j})=>e.jsxs(b,{wrap:!0,style:{marginBottom:16},size:[16,16],children:[e.jsx(ve,{value:o,onChange:s}),e.jsx(Ie,{value:d,loading:a,placeholder:"–¢–µ–≥–∏",tags:c,onChange:n,style:{minWidth:180}}),e.jsx(_,{value:l,loading:g,placeholder:"–ê–≤—Ç–æ—Ä—ã",users:i,onChange:m,style:{minWidth:220}}),e.jsx(_,{value:r,loading:g,placeholder:"–ü—Ä–æ–≤–µ—Ä—è—é—â–∏–µ",users:i,onChange:v,style:{minWidth:220}}),e.jsx(V.RangePicker,{onChange:y=>x(y),placeholder:["–£—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ –æ—Ç","–£—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ –¥–æ"]}),e.jsx(V.RangePicker,{onChange:y=>k(y),placeholder:["–†–µ–≤–∏–∑–∏—è –æ—Ç","–†–µ–≤–∏–∑–∏—è –¥–æ"]}),e.jsx(Q,{type:"primary",icon:e.jsx(B,{}),onClick:j,children:"–î–æ–±–∞–≤–∏—Ç—å –Ω–∞–≤—ã–∫"})]}),Te=({skills:o,loading:d,total:l,page:r,pageSize:c,onPageChange:i,onRowClick:a})=>{const g=[{title:"–ù–∞–∑–≤–∞–Ω–∏–µ",dataIndex:"title",key:"title"},{title:"–¢–∏–ø",dataIndex:"type",key:"type",render:s=>s==="skill"?"–ù–∞–≤—ã–∫":"–î–æ–∫—É–º–µ–Ω—Ç"},{title:"–î–∞—Ç–∞ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è",dataIndex:"approvedDate",key:"approvedDate",render:s=>s?new Date(s).toLocaleDateString():"-"},{title:"–î–∞—Ç–∞ —Ä–µ–≤–∏–∑–∏–∏",dataIndex:"auditDate",key:"auditDate",render:s=>s?new Date(s).toLocaleDateString():"-"},{title:"–í–µ—Ä—Å–∏—è",dataIndex:"version",key:"version"},{title:"–¢–µ–≥–∏",dataIndex:"tags",key:"tags",render:s=>e.jsx(b,{size:[4,4],wrap:!0,children:s.map(n=>e.jsx(oe,{children:n.name},n.id))})}];return e.jsx(fe,{rowKey:"id",loading:d,dataSource:o,columns:g,onRow:s=>({onClick:()=>a(s)}),pagination:{current:r,pageSize:c,total:l,showSizeChanger:!0,onChange:i}})},we=({value:o,onChange:d,tags:l,onEditTag:r,onCreateTag:c})=>{const[i,a]=h.useState(o||[]),g=n=>{a(n),d?.(n)},s=n=>{const m=l.find(v=>v.id===n);m&&r&&r(m)};return e.jsxs(b,{direction:"vertical",style:{width:"100%"},children:[e.jsx(I,{mode:"multiple",placeholder:"–í—ã–±–µ—Ä–∏—Ç–µ —Ç–µ–≥–∏",value:i,onChange:g,style:{width:"100%"},optionRender:n=>e.jsxs(re,{justify:"space-between",align:"center",children:[e.jsx("span",{children:n.label}),e.jsx(Q,{type:"text",size:"small",icon:e.jsx(de,{}),onClick:m=>{m.stopPropagation(),s(n.value)}})]}),options:l.map(n=>({value:n.id,label:n.name}))}),e.jsx(Q,{type:"dashed",icon:e.jsx(B,{}),onClick:c,style:{width:"100%"},children:"–°–æ–∑–¥–∞—Ç—å —Ç–µ–≥"})]})},be=({open:o,confirmLoading:d,onCancel:l,onSubmit:r})=>{const[c]=p.useForm(),i=()=>{c.submit()},a=s=>{r(s)},g=()=>{c.resetFields(),l()};return e.jsx(W,{open:o,title:"–°–æ–∑–¥–∞—Ç—å —Ç–µ–≥",onCancel:g,onOk:i,confirmLoading:d,destroyOnClose:!0,children:e.jsx(p,{form:c,layout:"vertical",onFinish:a,children:e.jsx(p.Item,{name:"name",label:"–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–µ–≥–∞",rules:[{required:!0,whitespace:!0,message:"–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–µ–≥–∞"},{max:50,message:"–ù–∞–∑–≤–∞–Ω–∏–µ –Ω–µ –¥–æ–ª–∂–Ω–æ –ø—Ä–µ–≤—ã—à–∞—Ç—å 50 —Å–∏–º–≤–æ–ª–æ–≤"}],children:e.jsx(w,{placeholder:"–ù–∞–∑–≤–∞–Ω–∏–µ"})})})})},Fe=({open:o,confirmLoading:d,tag:l,onCancel:r,onSubmit:c})=>{const[i]=p.useForm();h.useEffect(()=>{o&&l&&i.setFieldsValue({name:l.name})},[o,l,i]);const a=()=>{i.submit()},g=n=>{c(n)},s=()=>{i.resetFields(),r()};return e.jsx(W,{open:o,title:"–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–≥",onCancel:s,onOk:a,confirmLoading:d,destroyOnClose:!0,children:e.jsx(p,{form:i,layout:"vertical",onFinish:g,children:e.jsx(p.Item,{name:"name",label:"–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–µ–≥–∞",rules:[{required:!0,whitespace:!0,message:"–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–µ–≥–∞"},{max:50,message:"–ù–∞–∑–≤–∞–Ω–∏–µ –Ω–µ –¥–æ–ª–∂–Ω–æ –ø—Ä–µ–≤—ã—à–∞—Ç—å 50 —Å–∏–º–≤–æ–ª–æ–≤"}],children:e.jsx(w,{placeholder:"–ù–∞–∑–≤–∞–Ω–∏–µ"})})})})},Re=({open:o,confirmLoading:d,users:l,tags:r,onCancel:c,onSubmit:i})=>{const[a]=p.useForm(),[g,s]=h.useState([]),[n,m]=h.useState(null),[v,x]=h.useState(!1),[k,j]=h.useState(!1),[y,C]=h.useState(null),Y=p.useWatch("type",a),[L,{isLoading:T}]=ce(),[F,{isLoading:q}]=ue(),{refetch:R}=H({query:""}),E=()=>{a.submit()},$=u=>{i({...u,selectedTags:g,uploadedFile:n})},M=()=>{a.resetFields(),s([]),m(null),c()},D=async u=>{try{await L(u).unwrap(),f.success("–¢–µ–≥ —Å–æ–∑–¥–∞–Ω"),x(!1),R()}catch{f.error("–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ–≥–∞")}},A=async u=>{if(y)try{await F({id:y.id,body:u}).unwrap(),f.success("–¢–µ–≥ –æ–±–Ω–æ–≤–ª–µ–Ω"),j(!1),C(null),R()}catch{f.error("–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–µ–≥–∞")}},P=u=>{C(u),j(!0)},U={beforeUpload:u=>(m(u),!1),multiple:!1,maxCount:1,fileList:n?[{uid:"-1",name:n.name,status:"done"}]:[],onRemove:()=>{m(null)}};return e.jsxs(e.Fragment,{children:[e.jsx(W,{open:o,title:"–î–æ–±–∞–≤–∏—Ç—å –Ω–∞–≤—ã–∫",onCancel:M,onOk:E,confirmLoading:d,destroyOnHidden:!0,children:e.jsxs(p,{form:a,layout:"vertical",initialValues:{type:"skill"},onFinish:$,children:[e.jsx(p.Item,{name:"title",label:"–ù–∞–∑–≤–∞–Ω–∏–µ",rules:[{required:!0,whitespace:!0,message:"–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ"}],children:e.jsx(w,{})}),e.jsx(p.Item,{name:"type",label:"–¢–∏–ø",rules:[{required:!0,message:"–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø"}],children:e.jsx(I,{options:[{value:"skill",label:"–ù–∞–≤—ã–∫"},{value:"document",label:"–î–æ–∫—É–º–µ–Ω—Ç"}]})}),e.jsx(p.Item,{name:"approvedDate",label:"–î–∞—Ç–∞ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è",rules:[{required:!0,message:"–£–∫–∞–∂–∏—Ç–µ –¥–∞—Ç—É —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è"}],children:e.jsx(V,{style:{width:"100%"}})}),e.jsx(p.Item,{name:"verifierId",label:"–ü—Ä–æ–≤–µ—Ä—è—é—â–∏–π",rules:[{required:!0,message:"–£–∫–∞–∂–∏—Ç–µ –ø—Ä–æ–≤–µ—Ä—è—é—â–µ–≥–æ"}],children:e.jsx(I,{showSearch:!0,options:l.map(u=>({value:u.id,label:`${u.lastname} ${u.firstname}`.trim()}))})}),e.jsx(p.Item,{name:"authorId",label:"–ê–≤—Ç–æ—Ä",children:e.jsx(I,{allowClear:!0,showSearch:!0,options:l.map(u=>({value:u.id,label:`${u.lastname} ${u.firstname}`.trim()}))})}),e.jsx(p.Item,{label:"–¢–µ–≥–∏",children:e.jsx(we,{value:g,onChange:s,tags:r,onEditTag:P,onCreateTag:()=>x(!0)})}),Y==="document"&&e.jsxs(e.Fragment,{children:[e.jsx(p.Item,{label:"–ò–º—è —Ñ–∞–π–ª–∞",children:e.jsx(w,{placeholder:"–ù–∞–∑–≤–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞",value:n?.name,disabled:!0})}),e.jsxs(he.Dragger,{...U,children:[e.jsx("p",{className:"ant-upload-drag-icon",children:"üìÑ"}),e.jsx("p",{className:"ant-upload-text",children:"–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª –∏–ª–∏ –∫–ª–∏–∫–Ω–∏—Ç–µ"}),e.jsx("p",{className:"ant-upload-hint",children:"–§–∞–π–ª –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω"})]})]})]})}),e.jsx(be,{open:v,confirmLoading:T,onCancel:()=>x(!1),onSubmit:D}),e.jsx(Fe,{open:k,confirmLoading:q,tag:y,onCancel:()=>{j(!1),C(null)},onSubmit:A})]})},{Title:Me}=Ce,De=()=>{const o=pe(),[d,l]=h.useState(""),r=Se(d,600),[c,i]=h.useState(1),[a,g]=h.useState(10),[s,n]=h.useState([]),[m,v]=h.useState([]),[x,k]=h.useState([]),[j,y]=h.useState(null),[C,Y]=h.useState(null),[L,T]=h.useState(!1),{data:F=[],isFetching:q}=H({query:""}),R=F.map(t=>({id:t.id,name:t.name,skillsCount:0})),{data:E,isFetching:$}=ge({query:""}),M=E?.rows||[],{data:D,isFetching:A,refetch:P}=me({query:r||"",limit:a,page:c,tags:s.length?s.join(","):void 0,authorIds:m.length?m.join(","):void 0,verifierIds:x.length?x.join(","):void 0,approvedDates:j?j.map(t=>t.format("YYYY-MM-DD")).join(","):void 0,auditDates:C?C.map(t=>t.format("YYYY-MM-DD")).join(","):void 0}),U=D?.rows||[],u=D?.count||0,K=U.filter((t,S,O)=>O.findIndex(z=>z.id===t.id)===S),[G,{isLoading:J}]=xe(),[X]=je(),[Z]=ye();h.useEffect(()=>{i(1)},[r,s.join(","),m.join(","),x.join(","),j?.map(t=>t.format("YYYY-MM-DD")).join(","),C?.map(t=>t.format("YYYY-MM-DD")).join(",")]);const ee=(t,S)=>{i(t),g(S)},ae=h.useCallback(t=>{o(`/skills/${t.id}`)},[o]),te=async t=>{try{const S=t.approvedDate;let O;if(t.type==="document"&&t.uploadedFile)try{O=(await X({name:t.uploadedFile.name,file:t.uploadedFile}).unwrap()).id}catch{f.error("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª");return}else if(t.type==="document"&&!t.uploadedFile){f.error("–î–æ–±–∞–≤—å—Ç–µ —Ñ–∞–π–ª –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∞");return}const z={type:t.type,title:t.title,verifierId:t.verifierId,authorId:t.authorId,approvedDate:S?typeof S=="string"?S:S.toDate().toISOString():"",fileId:O},se=await G(z).unwrap();for(const N of t.selectedTags)try{await Z({id:se.id,tagId:N}).unwrap()}catch{}f.success("–ù–∞–≤—ã–∫ —Å–æ–∑–¥–∞–Ω"),T(!1),P()}catch{f.error("–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–∞–≤—ã–∫–∞")}};return e.jsxs(b,{direction:"vertical",style:{width:"100%"},size:24,children:[e.jsx(Me,{level:3,style:{margin:0},children:"–ù–∞–≤—ã–∫–∏"}),e.jsx(ke,{query:d,tagIds:s,authorIds:m,verifierIds:x,approvedRange:j,auditRange:C,tags:F,users:M,isTagsLoading:q,isUsersLoading:$,onQueryChange:l,onTagIdsChange:n,onAuthorIdsChange:v,onVerifierIdsChange:k,onApprovedRangeChange:y,onAuditRangeChange:Y,onCreateClick:()=>T(!0)}),e.jsx(Te,{skills:K,loading:A,total:u,page:c,pageSize:a,onPageChange:ee,onRowClick:ae}),e.jsx(Re,{open:L,confirmLoading:J,users:M,tags:R,onCancel:()=>T(!1),onSubmit:te})]})},Pe=()=>e.jsx(De,{});export{Pe as default};
