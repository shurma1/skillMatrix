import{k as ne,m as ie,l as se,n as j,o as oe,p as ae,r as x,q as le,j as e,L as de,T as q,C as O,h as R,S as p,g as J,B as f,t as ce,R as he,v as V,w as xe,x as ee,y as ge,d as te,z as ue,D as me,a as pe,E as je,G as fe,H as ye,J as ve,K as X,M as Se,N as $e,f as be,i as _,O as H}from"./index-C2zTCuKe.js";import{U as Ce}from"./UserAvatar-C1MRXXnW.js";import{S as U,R as Ie}from"./index-CX4mJsSu.js";import{R as we}from"./CheckCircleOutlined-BH__vJpJ.js";import{R as ke}from"./FileOutlined-2qhVAVZV.js";const ze=t=>{const{componentCls:n}=t;return{[n]:{"&-horizontal":{[`&${n}`]:{"&-sm":{marginBlock:t.marginXS},"&-md":{marginBlock:t.margin}}}}}},Te=t=>{const{componentCls:n,sizePaddingEdgeHorizontal:s,colorSplit:r,lineWidth:i,textPaddingInline:g,orientationMargin:l,verticalMarginInline:o}=t;return{[n]:Object.assign(Object.assign({},se(t)),{borderBlockStart:`${j(i)} solid ${r}`,"&-vertical":{position:"relative",top:"-0.06em",display:"inline-block",height:"0.9em",marginInline:o,marginBlock:0,verticalAlign:"middle",borderTop:0,borderInlineStart:`${j(i)} solid ${r}`},"&-horizontal":{display:"flex",clear:"both",width:"100%",minWidth:"100%",margin:`${j(t.marginLG)} 0`},[`&-horizontal${n}-with-text`]:{display:"flex",alignItems:"center",margin:`${j(t.dividerHorizontalWithTextGutterMargin)} 0`,color:t.colorTextHeading,fontWeight:500,fontSize:t.fontSizeLG,whiteSpace:"nowrap",textAlign:"center",borderBlockStart:`0 ${r}`,"&::before, &::after":{position:"relative",width:"50%",borderBlockStart:`${j(i)} solid transparent`,borderBlockStartColor:"inherit",borderBlockEnd:0,transform:"translateY(50%)",content:"''"}},[`&-horizontal${n}-with-text-start`]:{"&::before":{width:`calc(${l} * 100%)`},"&::after":{width:`calc(100% - ${l} * 100%)`}},[`&-horizontal${n}-with-text-end`]:{"&::before":{width:`calc(100% - ${l} * 100%)`},"&::after":{width:`calc(${l} * 100%)`}},[`${n}-inner-text`]:{display:"inline-block",paddingBlock:0,paddingInline:g},"&-dashed":{background:"none",borderColor:r,borderStyle:"dashed",borderWidth:`${j(i)} 0 0`},[`&-horizontal${n}-with-text${n}-dashed`]:{"&::before, &::after":{borderStyle:"dashed none none"}},[`&-vertical${n}-dashed`]:{borderInlineStartWidth:i,borderInlineEnd:0,borderBlockStart:0,borderBlockEnd:0},"&-dotted":{background:"none",borderColor:r,borderStyle:"dotted",borderWidth:`${j(i)} 0 0`},[`&-horizontal${n}-with-text${n}-dotted`]:{"&::before, &::after":{borderStyle:"dotted none none"}},[`&-vertical${n}-dotted`]:{borderInlineStartWidth:i,borderInlineEnd:0,borderBlockStart:0,borderBlockEnd:0},[`&-plain${n}-with-text`]:{color:t.colorText,fontWeight:"normal",fontSize:t.fontSize},[`&-horizontal${n}-with-text-start${n}-no-default-orientation-margin-start`]:{"&::before":{width:0},"&::after":{width:"100%"},[`${n}-inner-text`]:{paddingInlineStart:s}},[`&-horizontal${n}-with-text-end${n}-no-default-orientation-margin-end`]:{"&::before":{width:"100%"},"&::after":{width:0},[`${n}-inner-text`]:{paddingInlineEnd:s}}})}},Me=t=>({textPaddingInline:"1em",orientationMargin:.05,verticalMarginInline:t.marginXS}),Be=ne("Divider",t=>{const n=ie(t,{dividerHorizontalWithTextGutterMargin:t.margin,sizePaddingEdgeHorizontal:0});return[Te(n),ze(n)]},Me,{unitless:{orientationMargin:!0}});var Ee=function(t,n){var s={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&n.indexOf(r)<0&&(s[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(t);i<r.length;i++)n.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(s[r[i]]=t[r[i]]);return s};const De={small:"sm",middle:"md"},K=t=>{const{getPrefixCls:n,direction:s,className:r,style:i}=oe("divider"),{prefixCls:g,type:l="horizontal",orientation:o="center",orientationMargin:d,className:a,rootClassName:h,children:m,dashed:S,variant:y="solid",plain:N,style:L,size:P}=t,C=Ee(t,["prefixCls","type","orientation","orientationMargin","className","rootClassName","children","dashed","variant","plain","style","size"]),c=n("divider",g),[I,F,G]=Be(c),W=ae(P),w=De[W],k=!!m,$=x.useMemo(()=>o==="left"?s==="rtl"?"end":"start":o==="right"?s==="rtl"?"start":"end":o,[s,o]),z=$==="start"&&d!=null,T=$==="end"&&d!=null,A=le(c,r,F,G,`${c}-${l}`,{[`${c}-with-text`]:k,[`${c}-with-text-${$}`]:k,[`${c}-dashed`]:!!S,[`${c}-${y}`]:y!=="solid",[`${c}-plain`]:!!N,[`${c}-rtl`]:s==="rtl",[`${c}-no-default-orientation-margin-start`]:z,[`${c}-no-default-orientation-margin-end`]:T,[`${c}-${w}`]:!!w},a,h),M=x.useMemo(()=>typeof d=="number"?d:/^\d+$/.test(d)?Number(d):d,[d]),Q={marginInlineStart:z?M:void 0,marginInlineEnd:T?M:void 0};return I(x.createElement("div",Object.assign({className:A,style:Object.assign(Object.assign({},i),L)},C,{role:"separator"}),m&&l!=="vertical"&&x.createElement("span",{className:`${c}-inner-text`,style:Q},m)))},{Text:Oe}=q,Y=({user:t,size:n="default"})=>{const s=n==="small"?32:n==="large"?64:40,r=`${t.lastname||""} ${t.firstname||""} ${t.patronymic||""}`.trim()||t.login||"Неизвестный пользователь";return e.jsxs(de,{to:`/users/${t.id}`,style:{display:"flex",alignItems:"center",gap:8,textDecoration:"none",color:"inherit"},children:[e.jsx(Ce,{user:t,size:s}),e.jsx(Oe,{style:{fontSize:n==="small"?12:n==="large"?16:14},children:r})]})},{Title:Z,Paragraph:D,Text:u}=q,Ne=({skill:t,loading:n,author:s,verifier:r,loadingUsers:i,versionCount:g,onOpenVersions:l})=>e.jsx(O,{title:e.jsx(Z,{level:3,style:{margin:0},children:"Информация о навыке"}),extra:e.jsxs(f,{onClick:l,children:["Версии (",g,")"]}),children:n||!t?e.jsx(R,{active:!0,paragraph:{rows:6}}):e.jsxs(p,{direction:"vertical",size:16,style:{width:"100%"},children:[e.jsxs("div",{children:[e.jsx(Z,{level:4,style:{margin:0},children:t.title}),e.jsxs(u,{type:"secondary",children:["Тип: ",t.type==="document"?"Документ":"Навык"]})]}),e.jsxs(p,{direction:"vertical",size:8,style:{width:"100%"},children:[e.jsxs(D,{style:{margin:0},children:[e.jsx(u,{strong:!0,children:"Текущая версия: "}),t.version]}),e.jsxs(D,{style:{margin:0},children:[e.jsx(u,{strong:!0,children:"Утверждено: "}),t.approvedDate?new Date(t.approvedDate).toLocaleDateString():"—"]}),e.jsxs(D,{style:{margin:0},children:[e.jsx(u,{strong:!0,children:"Ревизия: "}),t.auditDate?new Date(t.auditDate).toLocaleDateString():"—"]}),e.jsxs(D,{style:{margin:0},children:[e.jsx(u,{strong:!0,children:"Статус: "}),e.jsx(J,{color:t.isActive?"green":"red",children:t.isActive?"Активен":"Неактивен"})]})]}),t.tags&&t.tags.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(K,{style:{margin:0}}),e.jsxs("div",{children:[e.jsx(u,{strong:!0,children:"Теги: "}),e.jsx("div",{style:{marginTop:8},children:e.jsx(p,{wrap:!0,children:t.tags.map(o=>e.jsx(J,{children:o.name},o.id))})})]})]}),e.jsx(K,{style:{margin:0}}),e.jsxs("div",{children:[e.jsx(u,{strong:!0,children:"Участники"}),e.jsx("div",{style:{marginTop:8},children:e.jsxs(p,{direction:"vertical",size:8,style:{width:"100%"},children:[e.jsxs("div",{children:[e.jsx(u,{type:"secondary",children:"Проверяющий:"}),e.jsx("div",{style:{marginTop:4},children:i?e.jsx(R.Button,{active:!0,size:"small"}):r?e.jsx(Y,{user:r,size:"small"}):e.jsx(u,{type:"secondary",children:"Не указан"})})]}),e.jsxs("div",{children:[e.jsx(u,{type:"secondary",children:"Автор:"}),e.jsx("div",{style:{marginTop:4},children:i?e.jsx(R.Button,{active:!0,size:"small"}):s?e.jsx(Y,{user:s,size:"small"}):e.jsx(u,{type:"secondary",children:"Не указан"})})]})]})})]})]})}),Le=({test:t,hasTest:n,loading:s,userTestResult:r,isUserTestResultLoading:i,onEditTest:g,onTakeTest:l,onGoToCreateTest:o,onViewTestResults:d})=>{const{token:a}=ce.useToken(),h=!!(r&&r.score>=r.needScore),m=!!r,S=()=>n?e.jsxs(p,{children:[m?e.jsx(xe,{title:`Тест уже пройден (${r?.score}/${r?.needScore} баллов). ${h?"Результат засчитан.":"Для повторного прохождения обратитесь к администратору."}`,children:e.jsx(f,{type:"primary",disabled:!0,onClick:l,children:"Пройти тест"})}):e.jsx(f,{type:"primary",onClick:l,children:"Пройти тест"}),m&&e.jsx(f,{icon:e.jsx(ee,{}),onClick:d,children:"Посмотреть все результаты"}),e.jsx(f,{icon:e.jsx(ge,{}),onClick:g,children:"Редактировать"})]}):e.jsx(f,{type:"primary",onClick:o,children:"Создать тест"}),y=()=>s?e.jsx("div",{children:"Загрузка..."}):n?t?e.jsxs(p,{direction:"vertical",size:16,style:{width:"100%"},children:[e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Название:"})," ",t.title]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Вопросов:"})," ",t.questionsCount]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Порог:"})," ",t.needScore]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Лимит времени:"})," ",t.timeLimit," сек."]})]}),m&&r&&e.jsxs("div",{style:{background:h?a.colorSuccessBg:a.colorWarningBg,padding:16,borderRadius:8,border:`1px solid ${h?a.colorSuccess:a.colorWarning}`},children:[e.jsx("h4",{style:{margin:"0 0 12px 0",color:h?a.colorSuccess:a.colorWarning},children:"Ваши результаты"}),e.jsxs(he,{gutter:16,children:[e.jsx(V,{span:8,children:e.jsx(U,{title:"Статус",value:h?"Пройден":"Не пройден",valueStyle:{color:h?a.colorSuccess:a.colorError},prefix:h?e.jsx(we,{}):e.jsx(Ie,{})})}),e.jsx(V,{span:8,children:e.jsx(U,{title:"Набрано баллов",value:r.score,suffix:`из ${r.needScore}`,valueStyle:{color:h?a.colorSuccess:a.colorError}})}),e.jsx(V,{span:8,children:e.jsx(U,{title:"Процент правильных",value:Math.round(r.score/r.questions.length*100),suffix:"%",valueStyle:{color:h?a.colorSuccess:a.colorError}})})]}),!h&&e.jsx("div",{style:{marginTop:12},children:e.jsx(J,{color:"warning",style:{fontSize:"13px"},children:"⚠ Требуется повторное прохождение"})})]}),i&&e.jsx("div",{children:"Загрузка результатов..."})]}):e.jsx("div",{children:"Информация о тесте недоступна"}):e.jsx("div",{children:"Тест не создан"});return e.jsx(O,{title:"Тест",extra:S(),children:y()})},{Text:v}=q,Pe=({fileInfo:t,loading:n,skillId:s})=>{const r=te(),i=()=>{r(`/skills/${s}/document`)};if(n)return e.jsx(O,{title:"Файл",children:e.jsx(ue,{})});if(!t)return null;const g=o=>{const d=["Б","КБ","МБ","ГБ"];if(o===0)return"0 Б";const a=Math.floor(Math.log(o)/Math.log(1024));return Math.round(o/Math.pow(1024,a)*100)/100+" "+d[a]},l=o=>new Date(o).toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"});return e.jsx(O,{title:e.jsxs(p,{children:[e.jsx(ke,{}),"Файл документа"]}),extra:e.jsx(f,{type:"primary",icon:e.jsx(ee,{}),onClick:i,children:"Открыть"}),children:e.jsxs(p,{direction:"vertical",style:{width:"100%"},children:[e.jsxs("div",{children:[e.jsx(v,{strong:!0,children:"Название: "}),e.jsx(v,{children:t.name})]}),e.jsxs("div",{children:[e.jsx(v,{strong:!0,children:"Размер: "}),e.jsx(v,{children:g(t.size)})]}),e.jsxs("div",{children:[e.jsx(v,{strong:!0,children:"Загружен: "}),e.jsx(v,{children:l(t.createdAt)})]})]})})},Fe=()=>{const{skillId:t=""}=me(),n=te(),s=pe(),{data:r,isFetching:i}=je(t,{skip:!t}),{data:g=[]}=fe(t,{skip:!t}),{data:l,isFetching:o,refetch:d}=ye(r?.testId,{skip:!r?.testId}),{data:a,isFetching:h}=ve(r?.testId,{skip:!r?.testId}),{data:m,isFetching:S}=X(r?.authorId,{skip:!r?.authorId}),{data:y,isFetching:N}=X(r?.verifierId,{skip:!r?.verifierId}),{data:L,isFetching:P}=Se(r?.fileId,{skip:!r?.fileId}),[C,{isLoading:c}]=$e(),{data:I}=be();x.useEffect(()=>{if(t)try{s(_.util.updateQueryData("getMySkills",void 0,b=>{const B=b?.find(E=>E.skillId===t);B&&(B.isNew=!1)})),(I||[]).forEach(b=>{s(_.util.updateQueryData("getMySkillsInJobrole",b.id,B=>{const E=B?.find(re=>re.skillId===t);E&&(E.isNew=!1)}))})}catch{}},[s,t,I]);const F=!!r?.testId,G=!!r?.fileId,W=S||N,w=g.length,k=x.useCallback(()=>{n(`/skills/${t}/versions`)},[n,t]),$=x.useCallback(async b=>{try{await C({skillId:t,...b}).unwrap(),H.success("Тест создан"),d()}catch{H.error("Ошибка создания теста")}},[C,d,t]),z=x.useCallback(async()=>{H.error("Удаление тестов пока не поддерживается")},[]),T=x.useCallback(()=>{r?.testId&&n(`/skills/${t}/test/${r.testId}/edit`)},[n,r?.testId,t]),A=x.useCallback(()=>{r?.testId&&n(`/test/${r.testId}/take`)},[n,r?.testId]),M=x.useCallback(()=>{n(`/skills/${t}/test/create`)},[n,t]),Q=x.useCallback(()=>{r?.testId&&n(`/test/${r.testId}/result/view`)},[n,r?.testId]);return e.jsxs(p,{direction:"vertical",size:24,style:{width:"100%"},children:[e.jsx(Ne,{skill:r,loading:i,author:m,verifier:y,loadingUsers:W,versionCount:w,onOpenVersions:k}),G&&e.jsx(Pe,{fileInfo:L,loading:P,skillId:t}),e.jsx(Le,{test:l,hasTest:F,loading:o,creating:c,deleting:!1,userTestResult:a,isUserTestResultLoading:h,onCreateTest:$,onDeleteTest:z,onEditTest:T,onTakeTest:A,onGoToCreateTest:M,onViewTestResults:Q})]})},Ve=()=>e.jsx(Fe,{});export{Ve as default};
