import{d as L,t as T,e as C,f as B,a as A,r as p,j as t,S as N,C as R,P,T as J,g as w,B as G,h as z,i as F}from"./index-C2zTCuKe.js";import{L as f}from"./index-DyZenP8S.js";import"./Pagination-Bu1Ky6rp.js";const{Text:g}=J,H=h=>h.type==="document"?"Документ":"Навык",Q=()=>{const h=L(),{token:i}=T.useToken(),{data:x,isFetching:y}=C(),{data:n,isFetching:k}=B(),u=A(),[m,S]=p.useState({}),[j,v]=p.useState(!1);p.useEffect(()=>{let e=!1;return(async()=>{if(!n||n.length===0){S({});return}v(!0);try{const c=await Promise.all(n.map(async r=>{const s=await u(F.endpoints.getMySkillsInJobrole.initiate(r.id)).unwrap();return{id:r.id,data:s}}));if(!e){const r={};c.forEach(({id:s,data:o})=>{r[s]=o}),S(r)}}finally{e||v(!1)}})(),()=>{e=!0}},[u,n]);const{items:b,loading:I}=p.useMemo(()=>{const e=new Map;(n||[]).forEach(s=>{(m[s.id]||[]).forEach(l=>{e.has(l.skillId)||e.set(l.skillId,new Set),e.get(l.skillId).add(s.title)})});const a=new Map;(x||[]).forEach(s=>a.set(s.skillId,s)),Object.values(m).forEach(s=>{s.forEach(o=>{a.has(o.skillId)||a.set(o.skillId,o)})});const c=Array.from(a.values()).map(s=>({us:s,jobroleTags:Array.from(e.get(s.skillId)||[])}));return c.sort((s,o)=>{const l=s.us.isNew?0:1,d=o.us.isNew?0:1;return l-d}),{items:c,loading:y||k||j}},[n,m,x,y,k,j]),E=p.useCallback(e=>h(`/skills/${e}`),[h]);return t.jsx(N,{direction:"vertical",size:24,style:{width:"100%",padding:24},children:t.jsxs(R,{title:"Мои навыки",children:[t.jsx(f,{dataSource:b,loading:I,renderItem:({us:e,jobroleTags:a})=>{const c=H(e),r=e.level>=e.targetLevel,s="isExpired"in e?!!e.isExpired:!1,o=e.isNew?i.colorInfo:s?i.colorError:e.isConfirmed?i.colorSuccess:i.colorBorder,l=Math.max(1,e.targetLevel||1);return t.jsx(f.Item,{actions:[t.jsx(G,{type:"primary",onClick:()=>E(e.skillId),children:"Перейти"},"go")],style:{background:i.colorBgContainer,borderRadius:8,padding:16,marginBottom:12,border:`1px solid ${o}`},children:t.jsx(f.Item.Meta,{title:t.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:8,alignItems:"center"},children:[t.jsx(g,{strong:!0,children:e.title}),t.jsx(w,{color:"default",children:c}),a.map(d=>t.jsx(w,{color:"blue",children:d},d)),e.isNew&&t.jsx(g,{style:{color:i.colorInfo},children:"(Новый)"}),!e.isNew&&s&&t.jsx(g,{style:{color:i.colorError},children:"(Просрочен)"})]}),description:t.jsx("div",{style:{width:"100%",marginTop:8},children:t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[t.jsx("div",{style:{flex:1},children:t.jsx(P,{percent:Math.round(e.level/Math.max(l,e.level)*100),steps:Math.max(l,e.level),size:[50,5],status:r?"success":"active",strokeColor:e.level>l?Array.from({length:Math.max(l,e.level)},(d,M)=>M<l?i.colorInfo:i.colorSuccess):void 0})}),t.jsxs(g,{type:"secondary",style:{whiteSpace:"nowrap",flexShrink:0},children:[e.level,"/",l]})]})})})})}}),I&&t.jsx(z,{active:!0,paragraph:{rows:3}})]})})},W=()=>t.jsx(Q,{});export{W as default};
