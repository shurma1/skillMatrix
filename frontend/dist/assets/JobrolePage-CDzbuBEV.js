import{j as e,C as F,h as oe,S as f,T as ce,B as k,y as T,aG as A,g as J,ak as M,bO as E,F as p,W as b,I as de,r as j,as as ue,ap as D,D as pe,d as xe,b$ as he,c0 as me,c1 as ge,X as ke,c2 as ye,c3 as je,c4 as Se,c5 as fe,c6 as be,c7 as Ie,O as x}from"./index-C2zTCuKe.js";import{F as $}from"./Table-Ck7p-nsh.js";import{U as ve}from"./UserAvatar-C1MRXXnW.js";import{u as Re}from"./useDebounce-C9xaHpZH.js";import{S as Q}from"./SkillLevelSelect-D_L04xpJ.js";import"./index-G1xJ3cLY.js";import"./Pagination-Bu1Ky6rp.js";import"./FileOutlined-2qhVAVZV.js";const{Title:O,Text:we}=ce,Ue=({jobRole:t,loading:n,onEdit:r})=>e.jsx(F,{title:e.jsx(O,{level:3,style:{margin:0},children:"Информация о роли"}),extra:e.jsx(k,{type:"primary",icon:e.jsx(T,{}),onClick:r,disabled:n||!t,children:"Редактировать"}),children:n||!t?e.jsx(oe,{active:!0,paragraph:{rows:2}}):e.jsx(f,{direction:"vertical",size:16,style:{width:"100%"},children:e.jsxs("div",{children:[e.jsx(O,{level:4,style:{margin:0},children:t.title}),e.jsxs(we,{type:"secondary",children:["ID: ",t.id]})]})})}),Ce=({skills:t,loading:n,onAdd:r,onEdit:d,onRemove:o,onSkillClick:i})=>{const l=[{title:"Название",dataIndex:"title",render:(s,c)=>e.jsx(k,{type:"link",onClick:()=>i(c.skillId),style:{padding:0},children:s})},{title:"Тип",dataIndex:"type",render:s=>e.jsx(J,{color:s==="document"?"blue":"green",children:s==="document"?"Документ":"Навык"})},{title:"Теги",dataIndex:"tags",render:s=>e.jsx(f,{wrap:!0,children:s.map(c=>e.jsx(J,{color:"default",children:c.name},c.id))})},{title:"Целевой уровень",dataIndex:"targetLevel",render:s=>e.jsx(J,{color:"orange",children:s})},{title:"Действия",key:"actions",render:(s,c)=>e.jsxs(f,{children:[e.jsx(k,{type:"text",icon:e.jsx(T,{}),onClick:()=>d({skillId:c.skillId,targetLevel:c.targetLevel})}),e.jsx(M,{title:"Удалить навык?",description:"Вы уверены, что хотите удалить этот навык из роли?",onConfirm:()=>o(c.skillId),okText:"Да",cancelText:"Нет",children:e.jsx(k,{type:"text",danger:!0,icon:e.jsx(E,{})})})]})}];return e.jsx(F,{title:"Навыки роли",extra:e.jsx(k,{type:"primary",icon:e.jsx(A,{}),onClick:r,children:"Добавить навык"}),children:e.jsx($,{dataSource:t,columns:l,loading:n,rowKey:"skillId",pagination:{pageSize:10,showSizeChanger:!0}})})},Le=({users:t,loading:n,onUserClick:r,onAdd:d,onRemove:o})=>{const i=[{title:"",dataIndex:"avatarId",width:56,render:(l,s)=>e.jsx(ve,{user:{id:s.userId,login:s.login,email:s.email,firstname:s.firstname,lastname:s.lastname,patronymic:s.patronymic,avatar_id:s.avatarId},size:40})},{title:"Фамилия",dataIndex:"lastname",render:(l,s)=>e.jsx(k,{type:"link",onClick:()=>r(s.userId),style:{padding:0},children:l})},{title:"Имя",dataIndex:"firstname"},{title:"Отчество",dataIndex:"patronymic"},{title:"Логин",dataIndex:"login"},{title:"Email",dataIndex:"email"},{title:"Назначена",dataIndex:"assignedAt",render:l=>new Date(l).toLocaleDateString("ru-RU")},{title:"Действия",key:"actions",render:(l,s)=>e.jsx(M,{title:"Удалить пользователя из роли?",description:"Вы уверены, что хотите удалить этого пользователя из роли?",onConfirm:()=>o(s.userId),okText:"Да",cancelText:"Нет",children:e.jsx(k,{type:"text",danger:!0,icon:e.jsx(E,{})})})}];return e.jsx(F,{title:"Пользователи с этой ролью",extra:e.jsx(k,{type:"primary",icon:e.jsx(A,{}),onClick:d,children:"Добавить пользователя"}),children:e.jsx($,{dataSource:t,columns:i,loading:n,rowKey:"userId",pagination:{pageSize:10,showSizeChanger:!0},onRow:l=>({onClick:()=>r(l.userId),style:{cursor:"pointer"}})})})},Je=({open:t,jobRole:n,confirmLoading:r,onCancel:d,onSubmit:o})=>{const[i]=p.useForm(),l=async()=>{try{const s=await i.validateFields();o(s)}catch{}};return e.jsx(b,{open:t,title:"Редактировать роль",onCancel:d,onOk:l,confirmLoading:r,okText:"Сохранить",cancelText:"Отмена",destroyOnClose:!0,children:e.jsx(p,{form:i,layout:"vertical",preserve:!1,initialValues:{title:n?.title},children:e.jsx(p.Item,{name:"title",label:"Название роли",rules:[{required:!0,message:"Введите название роли"}],children:e.jsx(de,{})})})})},Fe=({open:t,disabledSkillIds:n,confirmLoading:r,onCancel:d,onSubmit:o})=>{const[i]=p.useForm(),[l,s]=j.useState(""),c=Re(l,300),{data:g,isFetching:u}=ue({query:c||" ",limit:50,page:1},{skip:!t}),I=j.useMemo(()=>g?.rows?g.rows.filter(m=>!n.includes(m.id)).map(m=>({label:m.title,value:m.id})):[],[g?.rows,n]),v=async()=>{try{const m=await i.validateFields();o(m.skillId,m.targetLevel),i.resetFields()}catch{}},R=()=>{i.resetFields(),s(""),d()};return e.jsx(b,{open:t,title:"Добавить навык к роли",onCancel:R,onOk:v,confirmLoading:r,okText:"Добавить",cancelText:"Отмена",destroyOnClose:!0,children:e.jsxs(p,{form:i,layout:"vertical",preserve:!1,initialValues:{targetLevel:1},children:[e.jsx(p.Item,{name:"skillId",label:"Навык",rules:[{required:!0,message:"Выберите навык"}],children:e.jsx(D,{showSearch:!0,placeholder:"Введите название навыка для поиска",optionFilterProp:"children",onSearch:s,loading:u,options:I,filterOption:!1})}),e.jsx(p.Item,{name:"targetLevel",label:"Целевой уровень",rules:[{required:!0,message:"Укажите целевой уровень"}],children:e.jsx(Q,{placeholder:"Выберите целевой уровень"})})]})})},Oe=({open:t,currentTargetLevel:n,confirmLoading:r,onCancel:d,onSubmit:o})=>{const[i]=p.useForm(),l=async()=>{try{const s=await i.validateFields();o(s.targetLevel)}catch{}};return e.jsx(b,{open:t,title:"Изменить целевой уровень",onCancel:d,onOk:l,confirmLoading:r,okText:"Сохранить",cancelText:"Отмена",destroyOnClose:!0,children:e.jsx(p,{form:i,layout:"vertical",preserve:!1,initialValues:{targetLevel:n},children:e.jsx(p.Item,{name:"targetLevel",label:"Целевой уровень",rules:[{required:!0,message:"Укажите целевой уровень"}],children:e.jsx(Q,{placeholder:"Выберите требуемый уровень"})})})})},Te=({open:t,users:n,disabledUserIds:r,confirmLoading:d,onCancel:o,onSubmit:i})=>{const[l]=p.useForm(),s=async()=>{try{const u=await l.validateFields();i(u.userId),l.resetFields()}catch{}},c=()=>{l.resetFields(),o()},g=n.filter(u=>!r.includes(u.id)).map(u=>({label:`${u.lastname} ${u.firstname} ${u.patronymic} (${u.login})`,value:u.id}));return e.jsx(b,{open:t,title:"Назначить пользователя на роль",onCancel:c,onOk:s,confirmLoading:d,okText:"Назначить",cancelText:"Отмена",destroyOnClose:!0,children:e.jsx(p,{form:l,layout:"vertical",preserve:!1,children:e.jsx(p.Item,{name:"userId",label:"Пользователь",rules:[{required:!0,message:"Выберите пользователя"}],children:e.jsx(D,{showSearch:!0,placeholder:"Выберите пользователя",optionFilterProp:"label",options:g})})})})},Ae=()=>{const{jobroleId:t=""}=pe(),n=xe(),{data:r,isFetching:d}=he(t,{skip:!t}),{data:o=[],isFetching:i,refetch:l}=me(t,{skip:!t}),{data:s=[],isFetching:c,refetch:g}=ge(t,{skip:!t}),{data:u}=ke({query:""}),[I,{isLoading:v}]=ye(),[R,{isLoading:m}]=je(),[q,{isLoading:z}]=Se(),[P,{isLoading:_}]=fe(),[V,{isLoading:B}]=be(),[G,{isLoading:K}]=Ie(),[N,w]=j.useState(!1),[W,U]=j.useState(!1),[X,C]=j.useState(!1),[S,L]=j.useState(null),H=o.map(a=>a.skillId),Y=s.map(a=>a.userId),y=a=>typeof a=="object"&&a&&"data"in a&&typeof a.data?.message=="string"?a.data.message:"Ошибка",Z=async a=>{try{await I({id:t,body:a}).unwrap(),x.success("Роль обновлена"),w(!1)}catch(h){x.error(y(h)||"Ошибка обновления")}},ee=async(a,h)=>{try{await R({id:t,data:{skillId:a,targetLevel:h}}).unwrap(),x.success("Навык добавлен"),U(!1),l()}catch(re){x.error(y(re)||"Ошибка добавления")}},se=async a=>{if(S)try{await q({id:t,skillId:S.skillId,data:{targetLevel:a}}).unwrap(),x.success("Уровень навыка обновлен"),L(null),l()}catch(h){x.error(y(h)||"Ошибка обновления")}},te=async a=>{try{await P({id:t,skillId:a}).unwrap(),x.success("Навык удален"),l()}catch(h){x.error(y(h)||"Ошибка удаления")}},ae=async a=>{try{await V({id:t,userId:a}).unwrap(),x.success("Пользователь назначен на роль"),C(!1),g()}catch(h){x.error(y(h)||"Ошибка назначения")}},le=async a=>{try{await G({id:t,userId:a}).unwrap(),x.success("Пользователь удален из роли"),g()}catch(h){x.error(y(h)||"Ошибка удаления")}},ne=a=>{n(`/users/${a}`)},ie=a=>{n(`/skills/${a}`)};return e.jsxs(f,{direction:"vertical",size:24,style:{width:"100%"},children:[e.jsx(Ue,{jobRole:r,loading:d,onEdit:()=>w(!0)}),e.jsx(Ce,{skills:o,loading:i||_,onAdd:()=>U(!0),onEdit:L,onRemove:te,onSkillClick:ie}),e.jsx(Le,{users:s,loading:c||K,onUserClick:ne,onAdd:()=>C(!0),onRemove:le}),e.jsx(Je,{open:N,jobRole:r||null,confirmLoading:v,onCancel:()=>w(!1),onSubmit:Z}),e.jsx(Fe,{open:W,disabledSkillIds:H,confirmLoading:m,onCancel:()=>U(!1),onSubmit:ee}),S&&e.jsx(Oe,{open:!0,currentTargetLevel:S.targetLevel,confirmLoading:z,onCancel:()=>L(null),onSubmit:se}),e.jsx(Te,{open:X,users:u?.rows||[],disabledUserIds:Y,confirmLoading:B,onCancel:()=>C(!1),onSubmit:ae})]})},_e=()=>e.jsx(Ae,{});export{_e as default};
