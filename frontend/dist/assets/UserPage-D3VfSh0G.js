import{Z as S,_ as he,q as K,$ as J,a0 as pe,a1 as ue,a2 as H,a3 as we,a4 as Pe,a5 as fe,a6 as Le,a7 as Ae,a8 as Me,a9 as Ne,aa as Te,r as v,ab as Oe,k as Ee,m as Re,n as z,ac as Ue,l as _e,ad as ze,ae as Be,o as De,p as Fe,af as Je,ag as me,ah as Ke,ai as ge,aj as qe,j as a,T as V,C as re,h as Y,c as W,B as G,ak as ve,L as ie,al as He,g as X,F as E,W as Z,am as Ge,an as Qe,O as R,ao as Ve,d as We,ap as se,D as Xe,a as Ye,b as Ze,K as et,aq as tt,ar as at,as as nt,at as st,au as lt,av as rt,aw as it,ax as ot,ay as ct,az as dt,S as ut,aA as mt}from"./index-C2zTCuKe.js";import{A as gt,g as xt,E as ht}from"./EditUserModal-DZu4zdMs.js";import{S as pt}from"./SkillLevelDisplay-BktIxDca.js";import{L as Q}from"./index-DyZenP8S.js";import{d as ft,D as vt}from"./index-JSlmoLFU.js";import{S as oe}from"./SkillLevelSelect-D_L04xpJ.js";import{R as yt}from"./CheckCircleOutlined-BH__vJpJ.js";import"./Pagination-Bu1Ky6rp.js";var ye=S.forwardRef(function(e,t){var n=e.prefixCls,s=e.forceRender,i=e.className,r=e.style,l=e.children,o=e.isActive,c=e.role,g=e.classNames,p=e.styles,d=S.useState(o||s),f=he(d,2),u=f[0],x=f[1];return S.useEffect(function(){(s||o)&&x(!0)},[s,o]),u?S.createElement("div",{ref:t,className:K("".concat(n,"-content"),J(J({},"".concat(n,"-content-active"),o),"".concat(n,"-content-inactive"),!o),i),style:r,role:c},S.createElement("div",{className:K("".concat(n,"-content-box"),g?.body),style:p?.body},l)):null});ye.displayName="PanelContent";var bt=["showArrow","headerClass","isActive","onItemClick","forceRender","className","classNames","styles","prefixCls","collapsible","accordion","panelKey","extra","header","expandIcon","openMotion","destroyInactivePanel","children"],be=S.forwardRef(function(e,t){var n=e.showArrow,s=n===void 0?!0:n,i=e.headerClass,r=e.isActive,l=e.onItemClick,o=e.forceRender,c=e.className,g=e.classNames,p=g===void 0?{}:g,d=e.styles,f=d===void 0?{}:d,u=e.prefixCls,x=e.collapsible,y=e.accordion,$=e.panelKey,b=e.extra,C=e.header,I=e.expandIcon,m=e.openMotion,P=e.destroyInactivePanel,k=e.children,M=pe(e,bt),j=x==="disabled",L=b!=null&&typeof b!="boolean",w=J(J(J({onClick:function(){l?.($)},onKeyDown:function(O){(O.key==="Enter"||O.keyCode===ue.ENTER||O.which===ue.ENTER)&&l?.($)},role:y?"tab":"button"},"aria-expanded",r),"aria-disabled",j),"tabIndex",j?-1:0),U=typeof I=="function"?I(e):S.createElement("i",{className:"arrow"}),B=U&&S.createElement("div",H({className:"".concat(u,"-expand-icon")},["header","icon"].includes(x)?w:{}),U),F=K("".concat(u,"-item"),J(J({},"".concat(u,"-item-active"),r),"".concat(u,"-item-disabled"),j),c),q=K(i,"".concat(u,"-header"),J({},"".concat(u,"-collapsible-").concat(x),!!x),p.header),N=we({className:q,style:f.header},["header","icon"].includes(x)?{}:w);return S.createElement("div",H({},M,{ref:t,className:F}),S.createElement("div",N,s&&B,S.createElement("span",H({className:"".concat(u,"-header-text")},x==="header"?w:{}),C),L&&S.createElement("div",{className:"".concat(u,"-extra")},b)),S.createElement(Pe,H({visible:r,leavedClassName:"".concat(u,"-content-hidden")},m,{forceRender:o,removeOnLeave:P}),function(T,O){var _=T.className,D=T.style;return S.createElement(ye,{ref:O,prefixCls:u,className:_,classNames:p,style:D,styles:f,isActive:r,forceRender:o,role:y?"tabpanel":void 0},k)}))}),Ct=["children","label","key","collapsible","onItemClick","destroyInactivePanel"],jt=function(t,n){var s=n.prefixCls,i=n.accordion,r=n.collapsible,l=n.destroyInactivePanel,o=n.onItemClick,c=n.activeKey,g=n.openMotion,p=n.expandIcon;return t.map(function(d,f){var u=d.children,x=d.label,y=d.key,$=d.collapsible,b=d.onItemClick,C=d.destroyInactivePanel,I=pe(d,Ct),m=String(y??f),P=$??r,k=C??l,M=function(w){P!=="disabled"&&(o(w),b?.(w))},j=!1;return i?j=c[0]===m:j=c.indexOf(m)>-1,S.createElement(be,H({},I,{prefixCls:s,key:m,panelKey:m,isActive:j,accordion:i,openMotion:g,expandIcon:p,header:x,collapsible:P,onItemClick:M,destroyInactivePanel:k}),u)})},It=function(t,n,s){if(!t)return null;var i=s.prefixCls,r=s.accordion,l=s.collapsible,o=s.destroyInactivePanel,c=s.onItemClick,g=s.activeKey,p=s.openMotion,d=s.expandIcon,f=t.key||String(n),u=t.props,x=u.header,y=u.headerClass,$=u.destroyInactivePanel,b=u.collapsible,C=u.onItemClick,I=!1;r?I=g[0]===f:I=g.indexOf(f)>-1;var m=b??l,P=function(j){m!=="disabled"&&(c(j),C?.(j))},k={key:f,panelKey:f,header:x,headerClass:y,isActive:I,prefixCls:i,destroyInactivePanel:$??o,openMotion:p,accordion:r,children:t.props.children,onItemClick:P,expandIcon:d,collapsible:m};return typeof t.type=="string"?t:(Object.keys(k).forEach(function(M){typeof k[M]>"u"&&delete k[M]}),S.cloneElement(t,k))};function St(e,t,n){return Array.isArray(e)?jt(e,n):fe(t).map(function(s,i){return It(s,i,n)})}function $t(e){var t=e;if(!Array.isArray(t)){var n=Ne(t);t=n==="number"||n==="string"?[t]:[]}return t.map(function(s){return String(s)})}var kt=S.forwardRef(function(e,t){var n=e.prefixCls,s=n===void 0?"rc-collapse":n,i=e.destroyInactivePanel,r=i===void 0?!1:i,l=e.style,o=e.accordion,c=e.className,g=e.children,p=e.collapsible,d=e.openMotion,f=e.expandIcon,u=e.activeKey,x=e.defaultActiveKey,y=e.onChange,$=e.items,b=K(s,c),C=Le([],{value:u,onChange:function(L){return y?.(L)},defaultValue:x,postState:$t}),I=he(C,2),m=I[0],P=I[1],k=function(L){return P(function(){if(o)return m[0]===L?[]:[L];var w=m.indexOf(L),U=w>-1;return U?m.filter(function(B){return B!==L}):[].concat(Te(m),[L])})};Ae(!g,"[rc-collapse] `children` will be removed in next major version. Please use `items` instead.");var M=St($,g,{prefixCls:s,accordion:o,openMotion:d,expandIcon:f,collapsible:p,destroyInactivePanel:r,onItemClick:k,activeKey:m});return S.createElement("div",H({ref:t,className:b,style:l,role:o?"tablist":void 0},Me(e,{aria:!0,data:!0})),M)});const ce=Object.assign(kt,{Panel:be});ce.Panel;const wt=v.forwardRef((e,t)=>{const{getPrefixCls:n}=v.useContext(Oe),{prefixCls:s,className:i,showArrow:r=!0}=e,l=n("collapse",s),o=K({[`${l}-no-arrow`]:!r},i);return v.createElement(ce.Panel,Object.assign({ref:t},e,{prefixCls:l,className:o}))}),Pt=e=>{const{componentCls:t,contentBg:n,padding:s,headerBg:i,headerPadding:r,collapseHeaderPaddingSM:l,collapseHeaderPaddingLG:o,collapsePanelBorderRadius:c,lineWidth:g,lineType:p,colorBorder:d,colorText:f,colorTextHeading:u,colorTextDisabled:x,fontSizeLG:y,lineHeight:$,lineHeightLG:b,marginSM:C,paddingSM:I,paddingLG:m,paddingXS:P,motionDurationSlow:k,fontSizeIcon:M,contentPadding:j,fontHeight:L,fontHeightLG:w}=e,U=`${z(g)} ${p} ${d}`;return{[t]:Object.assign(Object.assign({},_e(e)),{backgroundColor:i,border:U,borderRadius:c,"&-rtl":{direction:"rtl"},[`& > ${t}-item`]:{borderBottom:U,"&:first-child":{[`
            &,
            & > ${t}-header`]:{borderRadius:`${z(c)} ${z(c)} 0 0`}},"&:last-child":{[`
            &,
            & > ${t}-header`]:{borderRadius:`0 0 ${z(c)} ${z(c)}`}},[`> ${t}-header`]:Object.assign(Object.assign({position:"relative",display:"flex",flexWrap:"nowrap",alignItems:"flex-start",padding:r,color:u,lineHeight:$,cursor:"pointer",transition:`all ${k}, visibility 0s`},ze(e)),{[`> ${t}-header-text`]:{flex:"auto"},[`${t}-expand-icon`]:{height:L,display:"flex",alignItems:"center",paddingInlineEnd:C},[`${t}-arrow`]:Object.assign(Object.assign({},Be()),{fontSize:M,transition:`transform ${k}`,svg:{transition:`transform ${k}`}}),[`${t}-header-text`]:{marginInlineEnd:"auto"}}),[`${t}-collapsible-header`]:{cursor:"default",[`${t}-header-text`]:{flex:"none",cursor:"pointer"}},[`${t}-collapsible-icon`]:{cursor:"unset",[`${t}-expand-icon`]:{cursor:"pointer"}}},[`${t}-content`]:{color:f,backgroundColor:n,borderTop:U,[`& > ${t}-content-box`]:{padding:j},"&-hidden":{display:"none"}},"&-small":{[`> ${t}-item`]:{[`> ${t}-header`]:{padding:l,paddingInlineStart:P,[`> ${t}-expand-icon`]:{marginInlineStart:e.calc(I).sub(P).equal()}},[`> ${t}-content > ${t}-content-box`]:{padding:I}}},"&-large":{[`> ${t}-item`]:{fontSize:y,lineHeight:b,[`> ${t}-header`]:{padding:o,paddingInlineStart:s,[`> ${t}-expand-icon`]:{height:w,marginInlineStart:e.calc(m).sub(s).equal()}},[`> ${t}-content > ${t}-content-box`]:{padding:m}}},[`${t}-item:last-child`]:{borderBottom:0,[`> ${t}-content`]:{borderRadius:`0 0 ${z(c)} ${z(c)}`}},[`& ${t}-item-disabled > ${t}-header`]:{"\n          &,\n          & > .arrow\n        ":{color:x,cursor:"not-allowed"}},[`&${t}-icon-position-end`]:{[`& > ${t}-item`]:{[`> ${t}-header`]:{[`${t}-expand-icon`]:{order:1,paddingInlineEnd:0,paddingInlineStart:C}}}}})}},Lt=e=>{const{componentCls:t}=e,n=`> ${t}-item > ${t}-header ${t}-arrow`;return{[`${t}-rtl`]:{[n]:{transform:"rotate(180deg)"}}}},At=e=>{const{componentCls:t,headerBg:n,borderlessContentPadding:s,borderlessContentBg:i,colorBorder:r}=e;return{[`${t}-borderless`]:{backgroundColor:n,border:0,[`> ${t}-item`]:{borderBottom:`1px solid ${r}`},[`
        > ${t}-item:last-child,
        > ${t}-item:last-child ${t}-header
      `]:{borderRadius:0},[`> ${t}-item:last-child`]:{borderBottom:0},[`> ${t}-item > ${t}-content`]:{backgroundColor:i,borderTop:0},[`> ${t}-item > ${t}-content > ${t}-content-box`]:{padding:s}}}},Mt=e=>{const{componentCls:t,paddingSM:n}=e;return{[`${t}-ghost`]:{backgroundColor:"transparent",border:0,[`> ${t}-item`]:{borderBottom:0,[`> ${t}-content`]:{backgroundColor:"transparent",border:0,[`> ${t}-content-box`]:{paddingBlock:n}}}}}},Nt=e=>({headerPadding:`${e.paddingSM}px ${e.padding}px`,headerBg:e.colorFillAlter,contentPadding:`${e.padding}px 16px`,contentBg:e.colorBgContainer,borderlessContentPadding:`${e.paddingXXS}px 16px ${e.padding}px`,borderlessContentBg:"transparent"}),Tt=Ee("Collapse",e=>{const t=Re(e,{collapseHeaderPaddingSM:`${z(e.paddingXS)} ${z(e.paddingSM)}`,collapseHeaderPaddingLG:`${z(e.padding)} ${z(e.paddingLG)}`,collapsePanelBorderRadius:e.borderRadiusLG});return[Pt(t),At(t),Mt(t),Lt(t),Ue(t)]},Nt),Ot=v.forwardRef((e,t)=>{const{getPrefixCls:n,direction:s,expandIcon:i,className:r,style:l}=De("collapse"),{prefixCls:o,className:c,rootClassName:g,style:p,bordered:d=!0,ghost:f,size:u,expandIconPosition:x="start",children:y,destroyInactivePanel:$,destroyOnHidden:b,expandIcon:C}=e,I=Fe(N=>{var T;return(T=u??N)!==null&&T!==void 0?T:"middle"}),m=n("collapse",o),P=n(),[k,M,j]=Tt(m),L=v.useMemo(()=>x==="left"?"start":x==="right"?"end":x,[x]),w=C??i,U=v.useCallback((N={})=>{const T=typeof w=="function"?w(N):v.createElement(Je,{rotate:N.isActive?s==="rtl"?-90:90:void 0,"aria-label":N.isActive?"expanded":"collapsed"});return me(T,()=>{var O;return{className:K((O=T.props)===null||O===void 0?void 0:O.className,`${m}-arrow`)}})},[w,m,s]),B=K(`${m}-icon-position-${L}`,{[`${m}-borderless`]:!d,[`${m}-rtl`]:s==="rtl",[`${m}-ghost`]:!!f,[`${m}-${I}`]:I!=="middle"},r,c,g,M,j),F=v.useMemo(()=>Object.assign(Object.assign({},Ke(P)),{motionAppear:!1,leavedClassName:`${m}-content-hidden`}),[P,m]),q=v.useMemo(()=>y?fe(y).map((N,T)=>{var O,_;const D=N.props;if(D?.disabled){const ee=(O=N.key)!==null&&O!==void 0?O:String(T),te=Object.assign(Object.assign({},ge(N.props,["disabled"])),{key:ee,collapsible:(_=D.collapsible)!==null&&_!==void 0?_:"disabled"});return me(N,te)}return N}):null,[y]);return k(v.createElement(ce,Object.assign({ref:t,openMotion:F},ge(e,["rootClassName"]),{expandIcon:U,prefixCls:m,className:B,style:Object.assign(Object.assign({},l),p),destroyInactivePanel:b??$}),q))}),le=Object.assign(Ot,{Panel:wt});var Et={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M574 665.4a8.03 8.03 0 00-11.3 0L446.5 781.6c-53.8 53.8-144.6 59.5-204 0-59.5-59.5-53.8-150.2 0-204l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3l-39.8-39.8a8.03 8.03 0 00-11.3 0L191.4 526.5c-84.6 84.6-84.6 221.5 0 306s221.5 84.6 306 0l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3L574 665.4zm258.6-474c-84.6-84.6-221.5-84.6-306 0L410.3 307.6a8.03 8.03 0 000 11.3l39.7 39.7c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c53.8-53.8 144.6-59.5 204 0 59.5 59.5 53.8 150.2 0 204L665.3 562.6a8.03 8.03 0 000 11.3l39.8 39.8c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c84.5-84.6 84.5-221.5 0-306.1zM610.1 372.3a8.03 8.03 0 00-11.3 0L372.3 598.7a8.03 8.03 0 000 11.3l39.6 39.6c3.1 3.1 8.2 3.1 11.3 0l226.4-226.4c3.1-3.1 3.1-8.2 0-11.3l-39.5-39.6z"}}]},name:"link",theme:"outlined"},Rt=function(t,n){return v.createElement(qe,H({},t,{ref:n,icon:Et}))},de=v.forwardRef(Rt);const{Title:xe}=V,Ut=({user:e,loading:t,initials:n,onEdit:s,onAvatarChange:i})=>a.jsxs("div",{children:[a.jsx(xe,{level:3,style:{marginTop:0},children:"Пользователь"}),a.jsx(re,{children:t||!e?a.jsx(Y,{active:!0,avatar:!0,paragraph:{rows:4}}):a.jsxs(W,{gap:32,align:"start",children:[a.jsx(gt,{avatarId:e.avatar_id,initials:n,onChange:i}),a.jsx("div",{style:{flex:1},children:a.jsxs(W,{justify:"space-between",align:"start",gap:16,style:{width:"100%"},children:[a.jsxs("div",{style:{minWidth:0},children:[a.jsxs(xe,{level:4,style:{marginTop:0,marginBottom:8},children:[e.lastname," ",e.firstname," ",e.patronymic]}),a.jsxs("p",{style:{margin:0},children:[a.jsx("b",{children:"Логин:"})," ",e.login]}),a.jsxs("p",{style:{margin:"4px 0 0"},children:[a.jsx("b",{children:"Email:"})," ",e.email||"—"]})]}),a.jsx(G,{type:"primary",onClick:s,style:{whiteSpace:"nowrap"},children:"Редактировать"})]})})]})})]}),{Title:_t}=V,zt=e=>e.id||e.jobRoleId||"",Bt=({jobroles:e,loading:t,onAdd:n,onDelete:s,userId:i,jobRoleSkillsComponent:r})=>a.jsxs("div",{children:[a.jsx(_t,{level:3,children:"Должности пользователя"}),a.jsx(re,{title:a.jsxs(W,{justify:"space-between",align:"center",children:[a.jsxs("span",{children:["Должности (",e.length,")"]}),a.jsx(G,{size:"small",onClick:n,children:"Добавить"})]}),children:t?a.jsx(Y,{active:!0,paragraph:{rows:3}}):a.jsx(le,{accordion:!0,children:e.map(l=>{const o=zt(l);return a.jsx(le.Panel,{header:a.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:8},children:[l.title,a.jsx(ie,{to:`/jobroles/${o}`,onClick:c=>c.stopPropagation(),title:"Перейти к должности",style:{display:"inline-flex",alignItems:"center"},children:a.jsx(de,{style:{color:"#1677ff"}})})]}),extra:a.jsx(ve,{title:"Удалить должность?",okText:"Да",cancelText:"Нет",onConfirm:()=>s(o),children:a.jsx(G,{size:"small",danger:!0,type:"text",onClick:c=>c.stopPropagation(),children:"Удалить"})}),children:r(i,o)},o||l.title)})})})]}),Dt=(e,t)=>t<=0?0:Math.min(1,e/t),Ce=({level:e,target:t,height:n=8})=>{const s=Dt(e,t);return a.jsx("div",{style:{position:"relative",marginTop:8,height:n,borderRadius:n/2,overflow:"hidden",background:"rgba(255,77,79,0.35)"},children:a.jsx("div",{style:{position:"absolute",inset:0,width:`${(s*100).toFixed(2)}%`,background:"rgba(82,196,26,0.85)",transition:"width .4s"}})})},Ft=(e,t,n)=>{switch(e){case"acquired":return"Повышен";case"debuff":return"Снижен";case"admin_set":return t!==void 0&&n!==void 0?n>t?"Повышен":"Снижен":"Изменен";default:return e}},Jt=(e,t,n)=>{switch(e){case"acquired":return"green";case"debuff":return"red";case"admin_set":return t!==void 0&&n!==void 0?n>t?"green":"red":"orange";default:return"default"}},Kt=e=>{try{return new Date(e).toLocaleDateString("ru-RU")}catch{return e}},qt=(e,t)=>{const n=[...e].sort((i,r)=>new Date(i.date).getTime()-new Date(r.date).getTime()),s=n.findIndex(i=>i.id===t.id);return s<=0?0:n[s-1].level},{Text:ne}=V,Ht=({confirmations:e,loading:t=!1})=>!e.length&&!t?a.jsx(He,{description:"Нет подтверждений навыка"}):a.jsx(Q,{loading:t,size:"small",dataSource:e,renderItem:n=>{const s=n.type==="admin_set"?qt(e,n):void 0;return a.jsx(Q.Item,{children:a.jsxs("div",{style:{width:"100%"},children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:4},children:[a.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[a.jsx(X,{color:Jt(n.type,s,n.level),children:Ft(n.type,s,n.level)}),n.type==="admin_set"&&a.jsx(X,{color:"orange",style:{fontSize:"11px"},children:"Установлен администратором"})]}),a.jsx(ne,{type:"secondary",style:{fontSize:"12px"},children:Kt(n.date)})]}),a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[a.jsxs(ne,{strong:!0,children:["Уровень: ",a.jsx(pt,{level:n.level})]}),a.jsxs(ne,{type:"secondary",style:{fontSize:"12px"},children:["v",n.version]})]})]})})}}),{Title:Gt,Text:Qt}=V,Vt=({open:e,skillTitle:t,currentLevel:n,confirmLoading:s,onCancel:i,onSubmit:r})=>{const[l]=E.useForm(),o=async()=>{try{const g=await l.validateFields(),p={level:g.level,date:g.date.toISOString()};r(p)}catch{}},c=()=>{l.resetFields(),i()};return a.jsxs(Z,{title:"Добавить подтверждение навыка",open:e,onOk:o,onCancel:c,confirmLoading:s,okText:"Добавить",cancelText:"Отмена",children:[a.jsxs("div",{style:{marginBottom:16},children:[a.jsxs(Gt,{level:5,style:{margin:0},children:["Навык: ",t]}),a.jsxs(Qt,{type:"secondary",children:["Текущий уровень: ",n]})]}),a.jsxs(E,{form:l,layout:"vertical",initialValues:{level:1,date:ft()},children:[a.jsx(E.Item,{name:"level",label:"Уровень навыка",rules:[{required:!0,message:"Укажите уровень"}],children:a.jsx(oe,{placeholder:"Выберите уровень навыка",isFull:!0})}),a.jsx(E.Item,{name:"date",label:"Дата подтверждения",rules:[{required:!0,message:"Выберите дату"}],children:a.jsx(vt,{style:{width:"100%"},placeholder:"Выберите дату",format:"DD.MM.YYYY"})})]})]})},je=({userId:e,skillId:t,skillTitle:n,currentLevel:s})=>{const[i,r]=v.useState(!1),{data:l=[],isFetching:o,refetch:c}=Ge({id:e,skillId:t}),[g,{isLoading:p}]=Qe(),d=async u=>{try{await g({id:e,skillId:t,body:u}).unwrap(),R.success("Подтверждение добавлено"),r(!1),c()}catch(x){const y=x&&typeof x=="object"&&"data"in x&&typeof x.data?.message=="string"?x.data.message:"Ошибка добавления подтверждения";R.error(y)}},f=[{key:"confirmations",label:a.jsxs("span",{style:{display:"flex",alignItems:"center",gap:8},children:[a.jsx(yt,{}),"Подтверждения навыка (",l.length,")"]}),extra:a.jsx(G,{size:"small",type:"primary",onClick:u=>{u.stopPropagation(),r(!0)},children:"Добавить"}),children:a.jsx(Ht,{confirmations:l,loading:o})}];return a.jsxs(a.Fragment,{children:[a.jsx(le,{size:"small",ghost:!0,items:f,style:{marginTop:8}}),a.jsx(Vt,{open:i,skillTitle:n,currentLevel:s,confirmLoading:p,onCancel:()=>r(!1),onSubmit:d})]})},{Title:Wt}=V,Xt=({skills:e,loading:t,userId:n,onAdd:s,onDelete:i,onEditTarget:r})=>a.jsxs("div",{children:[a.jsx(Wt,{level:3,children:"Навыки пользователя"}),a.jsx(re,{title:a.jsxs("span",{children:["Навыки (",e.length,")"]}),extra:a.jsx(G,{size:"small",onClick:s,children:"Добавить"}),children:t?a.jsx(Y,{active:!0,paragraph:{rows:4}}):a.jsx(Q,{dataSource:e,renderItem:l=>a.jsxs(Q.Item,{style:{display:"block",paddingBottom:12},children:[a.jsxs("div",{style:{display:"flex",width:"100%",alignItems:"flex-start",gap:16},children:[a.jsxs(W,{vertical:!0,style:{flex:1},gap:4,children:[a.jsxs("strong",{style:{display:"inline-flex",alignItems:"center",gap:6},children:[l.title,a.jsx(ie,{to:`/skills/${l.skillId}`,title:"Перейти к навыку",onClick:o=>o.stopPropagation(),style:{display:"inline-flex",alignItems:"center"},children:a.jsx(de,{style:{color:"#1677ff"}})})]}),a.jsx("div",{children:l.tags.map(o=>a.jsx(X,{children:o.name},o.id))})]}),a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end",gap:4},children:[a.jsxs("div",{style:{fontWeight:600},children:[l.level,"/",l.targetLevel]}),a.jsxs("div",{style:{display:"flex",gap:4},children:[a.jsx(G,{size:"small",type:"link",onClick:()=>r({skillId:l.skillId,targetLevel:l.targetLevel}),children:"Изменить"}),a.jsx(ve,{title:"Удалить навык?",okText:"Да",cancelText:"Нет",onConfirm:()=>i(l.skillId),children:a.jsx(G,{size:"small",type:"link",danger:!0,children:"Удалить"})})]})]})]}),a.jsx(Ce,{level:l.level,target:l.targetLevel}),a.jsx(je,{userId:n,skillId:l.skillId,skillTitle:l.title,currentLevel:l.level})]})})})]}),Yt=({skill:e,onOpenSkill:t,showConfirmations:n=!1,userId:s})=>{const i=v.useMemo(()=>e.tags,[e.tags]),r=v.useMemo(()=>`${e.level}/${e.targetLevel}`,[e.level,e.targetLevel]),l=v.useCallback(()=>{t(e.skillId)},[t,e.skillId]),o=v.useCallback(c=>{c.stopPropagation()},[]);return a.jsxs(Q.Item,{onClick:l,style:{display:"block",paddingBottom:12,cursor:"pointer"},children:[a.jsxs("div",{style:{display:"flex",width:"100%",alignItems:"flex-start",gap:16},children:[a.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:4},children:[a.jsxs("strong",{style:{display:"inline-flex",alignItems:"center",gap:6},children:[e.title,a.jsx(ie,{to:`/skills/${e.skillId}`,title:"Перейти к навыку",onClick:o,style:{display:"inline-flex",alignItems:"center"},children:a.jsx(de,{style:{color:"#1677ff"}})})]}),a.jsx("div",{children:i.map(c=>a.jsx(X,{children:c.name},c.id))})]}),a.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end",gap:4},children:a.jsx("div",{style:{fontWeight:600},children:r})})]}),a.jsx(Ce,{level:e.level,target:e.targetLevel}),n&&s&&a.jsx(je,{userId:s,skillId:e.skillId,skillTitle:e.title,currentLevel:e.level})]})},Zt=S.memo(Yt),ea=({userId:e,jobroleId:t})=>{const{data:n,isFetching:s}=Ve({id:e,jobroleId:t}),i=We(),r=v.useCallback(l=>i(`/skills/${l}`),[i]);return s?a.jsx(Y,{active:!0,paragraph:{rows:2}}):n?.length?a.jsx(Q,{dataSource:n,renderItem:l=>a.jsx(Zt,{skill:l,onOpenSkill:r,showConfirmations:!0,userId:e},l.skillId)}):a.jsx("div",{children:"Нет навыков"})},ta=e=>{const[t]=E.useForm(),{open:n,title:s,okText:i,fieldLabel:r,options:l,onCancel:o,confirmLoading:c}=e,g=async()=>{try{const d=await t.validateFields();e.mode==="withNumber"?e.onSubmit(d.entityId,d.extraNumber):e.onSubmit(d.entityId)}catch{}},p=e.mode==="withNumber"?{extraNumber:e.numberInitial??1}:void 0;return a.jsx(Z,{open:n,title:s,okText:i,cancelText:"Отмена",onCancel:o,confirmLoading:c,onOk:g,destroyOnHidden:!0,children:a.jsxs(E,{form:t,layout:"vertical",initialValues:p,children:[a.jsx(E.Item,{name:"entityId",label:r,rules:[{required:!0,message:`Выберите ${r.toLowerCase()}`}],children:a.jsx(se,{showSearch:!0,placeholder:`Выберите ${r.toLowerCase()}`,filterOption:(d,f)=>(f?.label).toLowerCase().includes(d.toLowerCase()),options:l})}),e.mode==="withNumber"&&a.jsx(E.Item,{name:"extraNumber",label:e.numberFieldLabel,rules:[{required:!0,message:`Укажите ${e.numberFieldLabel.toLowerCase()}`}],children:a.jsx(se,{options:Array.from({length:(e.numberMax||5)-(e.numberMin||1)+1},(d,f)=>{const u=(e.numberMin||1)+f;return{value:u,label:u}})})})]})})},aa=({open:e,options:t,disabledIds:n,confirmLoading:s,onCancel:i,onSubmit:r})=>a.jsx(ta,{open:e,title:"Добавить должность",okText:"Добавить",fieldLabel:"Должность",options:t.map(l=>({value:l.id,label:l.title,disabled:n.includes(l.id)})),onCancel:i,confirmLoading:s,onSubmit:l=>r(l)}),na=({open:e,options:t,disabledIds:n,confirmLoading:s,onCancel:i,onSubmit:r})=>{const[l]=E.useForm(),o=Array.isArray(t)?t:[],c=async()=>{try{const d=await l.validateFields();r(d.skillId,d.targetLevel)}catch{}},g=()=>{i()},p=o.filter(d=>!n.includes(d.id)).map(d=>({label:d.title,value:d.id}));return a.jsx(Z,{open:e,title:"Добавить навык",onCancel:g,onOk:c,confirmLoading:s,okText:"Добавить",cancelText:"Отмена",destroyOnClose:!0,children:a.jsxs(E,{form:l,layout:"vertical",preserve:!1,initialValues:{targetLevel:1},children:[a.jsx(E.Item,{name:"skillId",label:"Навык",rules:[{required:!0,message:"Выберите навык"}],children:a.jsx(se,{showSearch:!0,placeholder:"Выберите навык",optionFilterProp:"label",options:p})}),a.jsx(E.Item,{name:"targetLevel",label:"Целевой уровень",rules:[{required:!0,message:"Укажите целевой уровень"}],children:a.jsx(oe,{placeholder:"Выберите целевой уровень"})})]})})},sa=({open:e,currentTarget:t,onCancel:n,onSubmit:s,confirmLoading:i})=>{const[r]=E.useForm(),l=async()=>{try{const o=await r.validateFields();s(o.targetLevel)}catch{}};return a.jsx(Z,{open:e,title:"Изменить целевой уровень",onCancel:n,onOk:l,confirmLoading:i,okText:"Сохранить",cancelText:"Отмена",destroyOnClose:!0,children:a.jsx(E,{form:r,layout:"vertical",preserve:!1,initialValues:{targetLevel:t},children:a.jsx(E.Item,{name:"targetLevel",label:"Целевой уровень",rules:[{required:!0,message:"Укажите целевой уровень"}],children:a.jsx(oe,{placeholder:"Выберите целевой уровень"})})})})},la=e=>e.id||e.jobRoleId||"",ra=()=>{const{userId:e=""}=Xe(),t=Ye(),n=Ze(h=>h.auth.user),{data:s,isFetching:i}=et(e,{skip:!e}),{data:r=[],isFetching:l,refetch:o}=tt(e,{skip:!e}),{data:c=[],isFetching:g,refetch:p}=at(e,{skip:!e}),{data:d}=nt({query:""}),{data:f}=st({query:""}),[u,{isLoading:x}]=lt(),[y,{isLoading:$}]=rt(),[b,{isLoading:C}]=it(),[I]=ot(),[m]=ct(),[P,{isLoading:k}]=dt(),[M,j]=v.useState(!1),[L,w]=v.useState(!1),[U,B]=v.useState(!1),[F,q]=v.useState(null),N=v.useMemo(()=>s?xt(s):"",[s]),T=c.map(h=>h.skillId),O=r.map(h=>la(h)).filter(Boolean),_=h=>typeof h=="object"&&h&&"data"in h&&typeof h.data?.message=="string"?h.data.message:"Ошибка",D=async h=>{try{await u({id:e,body:h}).unwrap(),R.success("Изменения сохранены"),j(!1),h.avatar_id&&n&&String(n.id)===e&&t(mt(h.avatar_id))}catch(A){R.error(_(A)||"Ошибка обновления")}},ee=async h=>{try{await y({id:e,body:{jobRoleId:h}}).unwrap(),R.success("Должность добавлена"),w(!1),o()}catch(A){R.error(_(A)||"Ошибка добавления")}},te=async(h,A)=>{try{await b({id:e,body:{skillId:h,targetLevel:A}}).unwrap(),R.success("Навык добавлен"),B(!1),p()}catch(ae){R.error(_(ae)||"Ошибка добавления")}},Ie=async h=>{try{await I({id:e,jobroleId:h}).unwrap(),R.success("Должность удалена"),o()}catch(A){R.error(_(A)||"Ошибка удаления")}},Se=async h=>{try{await m({id:e,skillId:h}).unwrap(),R.success("Навык удален"),p()}catch(A){R.error(_(A)||"Ошибка удаления")}},$e=async h=>{if(F)try{await P({id:e,skillId:F.skillId,body:{targetLevel:h}}).unwrap(),R.success("Цель обновлена"),q(null),p()}catch(A){const ae=A&&typeof A=="object"&&"data"in A?A.data?.message:"Ошибка обновления";R.error(ae||"Ошибка обновления")}},ke=(h,A)=>a.jsx(ea,{userId:h,jobroleId:A});return a.jsxs(ut,{direction:"vertical",size:32,style:{width:"100%"},children:[a.jsx(Ut,{user:s,loading:i,initials:N,onEdit:()=>j(!0),onAvatarChange:h=>D({avatar_id:h})}),a.jsx(Bt,{jobroles:r,loading:l,onAdd:()=>w(!0),onDelete:Ie,userId:e,jobRoleSkillsComponent:ke}),a.jsx(Xt,{skills:c,loading:g,userId:e,onAdd:()=>B(!0),onDelete:Se,onEditTarget:q}),a.jsx(ht,{open:M,user:s||null,confirmLoading:x,onCancel:()=>j(!1),onSubmit:D}),a.jsx(aa,{open:L,options:f?.rows||[],disabledIds:O,confirmLoading:$,onCancel:()=>w(!1),onSubmit:ee}),a.jsx(na,{open:U,options:d?.rows||[],disabledIds:T,confirmLoading:C,onCancel:()=>B(!1),onSubmit:te}),F&&a.jsx(sa,{open:!0,currentTarget:F.targetLevel,onCancel:()=>q(null),confirmLoading:k,onSubmit:$e})]})},ha=()=>a.jsx(ra,{});export{ha as default};
